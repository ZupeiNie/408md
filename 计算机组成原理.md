# 计算机组成原理

## 第一章 计算机系统概述

1.冯·诺伊曼机基本思想，运算器、存储器、控制器、输入设备、输出设备，存储程序的思想，MDR和MAR，MAR和存储字长相等为字节的二次幂整倍数；汇编程序，解释程序(一条一条)，编译程序(一次全部)；源程序->预处理器(对#开头的命令进行处理)->编译器(高级语言源代码到汇编语言or机器语言等低级语言目标代码)->汇编器(汇编语言源程序到机器语言程序，二进制文件)->链接器(生成可执行文件)

考点：源代码转变过程，冯·诺伊曼机基本思想

| 性能指标     | 含义                                                         |
| ------------ | ------------------------------------------------------------ |
| 机器字长     | 计算机进行一次整数计算所能处理的二进制数据的位数，即用于计算的运算器和存储器的长度 |
| 主存容量     | 字数*字长(512k·16位)                                         |
| 时钟周期     | 1/主频，CPU中最小的时间单位                                  |
| CPI          | 执行一条指令需要的时钟周期数                                 |
| CPU执行时间  | =CPU时钟周期数/主频=(指令条数*CPI)/主频                      |
| MIPS         | 每秒几百万条指令                                             |
| 其他浮点相关 | MFLOPS(10^6^)，GFLOPS(10^9^)，TFLOPS(10^12^)，PFLOPS(10^15^)，EFLOPS(10^18^)，ZFLOPS(10^21^) |

考点：基准程序计算，程序运行时间计算

2.CPU中，IR、MAR和MDR对各类程序员透明

| 字长(机器字长) | 计算机进行一次整数计算所能处理的二进制数据的位数，即用于计算的运算器和存储器的长度 |
| -------------- | ------------------------------------------------------------ |
| 指令字长       | 指令中二进制代码位数，一般为存储字长的整倍数，几倍为几个访存周期 |
| 存储字长       | 存储单元中二进制代码位数，为字节的整倍数                     |
| 字             | 用来表示被处理信息的单位                                     |

## 第二章 数据的表示和运算

1.进制转化，0正1负，原码(有正负0)反码(有正负0，负数各位取反)补码(0唯一，-2^n^到2^n^-1，正数不变，负数按位取反，末位+1)移码(0唯一，与补码符号位相反)

考点：负数原码-补码：从右向左找第一个1，这个1左边的数值取反

2.ALU算术逻辑单元，可实现左移右移；算数移位(正数补0，负数原码补0反码补1补码左移补0右移补1)，逻辑移位(视为无符号数，补0)，循环移位(大循环小循环，大循环带有CF进位标志位，实现数据的低字节数据和高字节数据互换)

3.零标志位ZF(1表示结果为0，都有意义)，溢出标志OF(1表示溢出，有符有)，符号标志SF(表示结果的符号，有符有)，进/借位标志CF(加法1表示溢出，减法1表示有借位，$CF=Sub\bigoplus C_{out}$，无符有)

| 1位符号位         | A符号位A~s~，B符号位B~s~，结果符号位S~s~，溢出表达式$V=A_sB_s\overline{S_s}+\overline{A_sB_s}S_s$，V=0无溢出，V=1溢出 |
| ----------------- | ------------------------------------------------------------ |
| 2位符号位         | 结果符号位S~s1~S~s2~，00正数无溢出，01正溢出，10负溢出，11负数无溢出，$V=S_{s1}\bigoplus S_{s2}$，V=0无溢出，V=1溢出 |
| 1位符号位+1位进位 | 符号位进位C~s~，最高数位的进位C~1~，$V=C_s\bigoplus C_1$，V=0无溢出，V=1溢出 |

4.有符号数和无符号数(符号位当作数位)，不同字长整数(高位截断，低位赋值；零扩展，高位补0、符号扩展，高位用原数字符号位填充)；大端存储(最高-最低)，小端存储(最低-最高)，边界对齐

考点：判大小，计算，判范围，判溢出，存储方式，数据转换，标志位计算

5.浮点数：数符，阶码-移码，尾数-原码；规格化，左规乘2，右规除2；阶码，偏置值127；对阶，小向大看齐；0舍1入，最高位为0舍去，最高位为1尾数末尾+1、恒置1法，移位丢失的位有1则将尾数末尾置1、截断法，截断所需的位数；溢出判断，只有右规上溢，左规下溢取0，上溢中断计算处理溢出

考点：数据范围，计算，表示，进行规格化

## 第三章 存储系统

1.主存-cache-外存；随机存储器RAM(不破坏，易失)，只读存储器ROM(非易失)，串行访问存储器包括：顺序存取存储器(磁带)和直接存取存储器(磁盘，光盘)；存取周期->存储器进行一次完整的读写操作所需的全部时间；主存和cache之间的数据调用由硬件完成，对所有程序员透明、主存和外存之间的数据调用则是硬件和操作系统共同完成，对应用程序员透明

2.主存DRAM(电荷存储信息，破坏性读出，行列地址分两次送)，Cache为SRAM(双稳态触发器，非破坏性，行列地址同时送)；DRAM刷新周期包括集中刷新、分散刷新和异步刷新(刷新周期/行数)；DRAM地址引脚复用，即行列地址分两次送，使地址引脚数量减少一半；单体多字存储器和多体低位交叉存储器(高位交叉编址-顺序方式，低位交叉编址-交叉方式)

考点：ROM，RAM性质，地址引脚数量计算，计算存储周期(地址+数据)，访存冲突(n体交叉，相邻n次访问中出现同一个存储模块即冲突)

3.位拓展法，字拓展法，字位同时拓展法；线选法，译码片选法

考点：不同拓展方式判断属于哪块，计算需要多少芯片：一块芯片大小为8k·8位，要组成32k·32位存储器，内存按字节编址，则一组芯片的大小为8k·32位，前面为一块的数据，后面为要组成的位数，也就是计算要达到同位数需要几块芯片就是几块芯片一组

4.磁盘，串形，不能同时读和写，也不能同时读或写两组数据，最小读写单位为扇区；SSD，以页位单位读写

考点：磁盘读取时间=寻道时间+旋转时间+传输时间

5.Cache和主存之间数据交换单位为块；直接映射(Cache行号=主存块号 mod Cache总行数，地址结构：标记+Cache行号+快内地址)，全相联映射(地址结构：标记+快内地址，计算一般不考)，组相联映射(Cache组号=主存块号 mod Cache组数，地址结构：标记+组号+快内地址)；Cache总容量=存储容量(数据区) + 标记项(有效位，标记位，替换位，脏位等)

考点：计算Cache命中率，分析映射方式

6.替换算法，随机算法RAND，先进先出FIFO，近期最少使用LRU(堆栈类)，最不经常使用LFU；Cache写策略，全写法(写命中同时写入Cache和主存，替换时不写回主存，直接替换)和回写法(写命中只写入Cache，替换时才写回主存，设置脏位)，写不命中时有写分配法(加载块到cache，然后更新)和非写分配法(只写入主存)

考点：替换算法模拟，计算Cache行的总位数

7.虚拟存储机制采用全相联映射和回写法，TLB和Page和Cache命中关系，信息不在Page也就是不在主存就一定不在Cache

考点：地址转换，直写(同时写回Cache和主存)，Cache行容量=一块主存块大小+tag+脏位，有效位等等，指令周期需要访问几次主存，注意指令周期包括取数、运算和写回，看题目要求哪些步骤

## 第四章 指令系统

1.零地址(空操作指令，停机指令，关中断指令，操作数来自栈顶和次栈顶)，四地址指令(A~4~为下址，下一条指令的地址)；拓展操作码；执行调用指令需要保存下一条指令的地址(返回地址)，而转移地址不返回执行，即调用指令类似调用函数还是要回到主函数

考点：计算拓展操作码，注意指令字长为字节整倍数，看按什么编址

2.指令寻址(找下一条要执行的指令)：顺序寻址(PC=PC+1)和跳跃寻址(绝对地址和相对地址)；数据寻址(表示一个操作数的地址)：下表，堆栈寻址(LIFO)

| 寻址方式           | 说明                                                         | 访存次数 |
| ------------------ | ------------------------------------------------------------ | -------- |
| 隐含寻址           | 利用累加器ACC，EA=程序指定                                   | 0        |
| 立即寻址           | A=操作数                                                     | 0        |
| 直接寻址           | EA=A                                                         | 1        |
| 一次间接寻址       | EA=(A)                                                       | 2        |
| 寄存器寻址         | EA=R                                                         | 0        |
| 寄存器一次间接寻址 | EA=(R)                                                       | 1        |
| 相对寻址           | EA=(PC)+A，注意JMP A，看指令长度来判断PC需要+几              | 1        |
| 基址寻址           | EA=(BR)+A，可用通用寄存器or专用寄存器，基址寄存器面向系统，不可变，A可变 | 1        |
| 变址寻址           | EA=(IX)+A，数组处理，循环程序，变址寄存器面向用户，可变，A不可变 | 1        |

考点；不同寻址方式计算地址

3.AT&T格式(寄存器前加%，立即数前加$)和Intel格式，区别见p193；汇编指令包括数据传送指令、逻辑计算指令和控制流指令；call/ret指令位无条件转移指令

|                  | CISC复杂指令系统                     | RISC精简指令系统                 |
| ---------------- | ------------------------------------ | -------------------------------- |
| 指令系统         | 复杂                                 | 精简                             |
| 指令数目         | 一般大于200条                        | 一般小于100条                    |
| 指令字长         | 不固定                               | 固定                             |
| 可访存指令       | 不加限制                             | 只有Load/Store指令               |
| 各种指令执行时间 | 相差较大                             | 绝大多数在一个周期内完成         |
| 各种指令使用频率 | 相差很大                             | 都比较常用                       |
| 通用寄存器数量   | 较少                                 | 多                               |
| 目标代码         | 难以用优化编译生成高效的目标代码程序 | 采用优化编译程序，生成代码较简洁 |
| 控制方式         | 绝大多数为微程序控制                 | 绝大多数为组合逻辑控制           |
| 指令流水线       | 可以通过一定方式实现                 | 必须实现                         |

考点：两者各自特点区别

## 第五章 中央处理器

1.指令周期=取指周期FE+间址周期IND(访问主存取出EA)+执行周期EX+中断周期INT(SP-1)；单指令周期(串行+同时钟周期)，多指令周期(串行+不同时钟周期)，流水线(并行)

2.数据通路：数据在功能部件之间传递的路径，包括部件比如ALU、通用寄存器、状态寄存器、异常和中断处理逻辑等；基本结构有CPU内部单总线(一个时钟周期只传一个数据即只允许一次操作，不能用在单指令周期)、CPU内部三总线和专用数据通路方式

3.硬布线控制器和微程序控制器，机器周期：内存中读取以一个指令字的最短时间；CPU控制方式包括同步控制、异步控制和联合控制；微程序->微指令->微操作(执行过程)，微命令(控制信号)，微程序的结构和功能是透明的，微指令编码方式包括直接编码(对应位设为0，1)、字段直接编码(互斥的一个段，相容的不同段、每个段信息位不能太多、每个段留出一个状态表示本字段不发出任何微命令)、字段间接编码(由另一个字段中的微命令来解释)；微指令的格式包括水平型微指令(定义并执行几种并行的基本操作，效率高灵活性强时间短、微指令字较长微程序短、但难以掌握)和垂直型微指令(只定义并执行一种基本操作，效率低灵活性差时间长、微指令字较短微程序长，容易掌握)

|          | 微程序控制器                                                 | 硬布线控制器                                                 |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 工作原理 | 微操作控制信息以微程序的形式存放在控制存储器中，执行指令时读出即可 | 微操作控制信号由组合逻辑电路根据当前的指令码，状态和时序，即时产生 |
| 执行速度 | 慢                                                           | 快                                                           |
| 规整性   | 较规整                                                       | 繁琐，不规整                                                 |
| 应用场合 | CISC，CPU                                                    | RICS，CPU                                                    |
| 易扩展性 | 易扩展修改                                                   | 困难                                                         |

考点：上表

4.异常包括故障、自陷、终止，中断分可屏蔽和不可屏蔽；页缺失处理完成后回到当前指令执行而不是下一条，详细见os

5.指令流水线：取指IF->译码/读寄存器ID->执行/计算机制EX->访存MEM->写回WB，每条指令的时钟周期数即CPI为1；结构冒险(资源冲突)、数据冒险(数据冲突)和控制冒险(控制冲突)；数据冒险分为写后读、读后写、写后写，解决办法为将数据相关的指令往后拖几个周期，有硬件阻塞stall和软件插入NOP指令两种方式，或者是设置相关专用通路即数据旁路技术，或者调整指令顺序

6.超标量流水线(动态多发射技术，每个时钟周期内可并发多条独立指令，CPI<1)，超长指令字技术(将多条合并为一条)、超流水线技术(流水线功能段划分更多，提高流水线主频，即一个时间周期内不同时发送多条指令，CPI<1)

考点：计算CPU周期时间，流水线吞吐率，数据冒险的指令对，计算时钟周期

7.SISD单指令流单数据流结构(计组讲的大部分为这个)，SIMD单指令流多数据流结构，MISD多指令流单数据流结构(不存在)，MIMD多指令流多数据流结构；硬件多线程实现方式：细粒度多线程(多个线程可以交叉乱序并行执行)，粗粒度多线程(只有一个线程阻塞时才切换线程，开销大)，同时多线程(同一个时钟周期内，发射多个不同线程中的多条指令)

## 第六章 总线

1.总线的特点：分时、共享；主设备、从设备；机械特性、电气特性、功能特性、时间特性；片内总线(芯片内部的总线)、系统总线(各功能部件之间互相连接的总线)、I/O总线(连接低中速的I/O设备，常见USB，PIC总线)；通信总线(外部总线，连接其他系统)；同步总线、异步总线，并行总线、串行总线

2.单总线结构(I/O设备与主存、CPU与主存、CPU与外设直接交换信息)、双总线结构(一条主存总线，用在CPU主存和通道之间，一条I/O总线用在多个外部设备与通道之间)、三总线结构(主存总线、I/O总线和直接内存访问DMA总线，DMA用在内存与高速外设之间)

3.常见总线标准p288：ISA，EISA，VESA(局部总线)，PIC(即插即用，局部总线，与时钟频率无关)，USB(串行)，AGP(加速图形，视频，局部总线)，PIC-E，RS-232C(串行)，PCMCIA，IDE(ATA)，SCSI，SATA(串行)

考点：总线带宽=时钟频率*一个时钟周期内可以传的数据大小，总线标准，突发传输：一次传输一个地址或一批地址连续的数据

4.总线两种基本定时方式：同步(统一的时钟信号)，异步(双方相互制约的“握手”信号，又有不互锁方式[主设备发送请求等一段时间后自动撤销，从设备的回答信号发送后等一段时间自动撤销，互不牵制]，半互锁[主设备的请求信号一定要有回答信号才能撤销，但从设备的回答信号则一段时间后自动撤销]，全互锁[主设备的请求要等从设备的回答，从设备的回答要等主设备的请求撤销消息])

考点：注意概念

## 第七章 输入/输出系统

1.I/O接口时主机和外设之间的交接界面；并行接口和串行接口；I/O端口有统一编址(把I/O端口当为存储的单元，不需要专门的I/O指令，可用同统一的访存指令)和独立编址(I/O映射，I/O端口空间和主存空间分开独立，需要专门的I/O指令)

2.I/O方式：程序查询，不断询问信号来判断是数据传送还是等待，CPU踏步等待，CPU和I/O串行工作 ；程序中断方式；DMA方式，硬件完成，开辟直接数据通道信息不经过CPU，当CPU和外设同时访问主存可能发生冲突，采用停止CPU访存、周期挪用(单字传送)和DMA与CPU交替访存

考点：中断屏蔽字，中断流程，不同I/O方式下I/O时间占比

## 注意点

原码的加减法，一种是转成补码计算再转原码，还有就是原码直接计算p55

char为1字节，short为2字节，int为4字节，double为8字节

汇编程序员可见PC，基址寄存器，状态/标志寄存器PSW，通用寄存器，中断字寄存器

数据相关：一个程序中存在必须等前一条指令执行完才能执行下一条指令的情况

虚拟页面缓存在TLB中，分配在内存中，不存在已缓存未分配

Cache-主存系统效率=纯Cache命中所花时间/实际所花时间

规格化的尾数的绝对值>1/基数，用来判断是否规格化

物理地址表示可能是10进制，需要先转2进制，然后地址结构为页框号+页内地址

微程序入口地址由微指令的下址字段或机器指令的操作码

通道：软硬件结合

Cahce缓冲存储器用来存放最近的数据

数据转换不变int->float->double

注意大小端存储和边界对齐，边界对齐要注意该数据能否在一个块内存储

PC位数为存储器字长=主存空间/字长

低位交叉编址，计算读取所需存储周期，判断几块芯片，判断从哪开始